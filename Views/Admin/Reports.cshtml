
@using BookSwap.Services
@{
    ViewData["Title"] = "Admin Reports";

    // Pull fake data from the FakeDatabase service
    var books = FakeDatabase.Books;
    var orders = FakeDatabase.Orders;
    var users = FakeDatabase.Users  ;

    // Stats
    int totalOrders = orders.Count;
    int completedOrders = orders.Count(o => o.Status == "Completed");
    int pendingOrders = orders.Count(o => o.Status == "Pending");
    decimal totalRevenue = (decimal)orders.Sum(o => o.TotalPrice);
    int totalBooks = books.Count;
    int totalUsers = users.Count;
    int buyerCount = users.Count(u => u.role == "Buyer");
    int sellerCount = users.Count(u => u.role == "Seller");
    int adminCount = users.Count(u => u.role  == "Admin");

   @* var booksDict = _bookRepo.getAll().ToDictionary(b => b.Id, b => b.Title);

var bestSeller = orders
    .GroupBy(o => booksDict[o.bookid])
    .OrderByDescending(g => g.Count())
    .FirstOrDefault()?.Key ?? "No sales yet"; *@



   var topBuyerId = orders
    .GroupBy(o => o.BuyerId)
    .OrderByDescending(g => g.Count())
    .FirstOrDefault()?.Key;

string topBuyer = topBuyerId != null ? topBuyerId.ToString() : "No buyers yet";


<div class="container">
    <h2 class="mb-4 fw-bold">üìä Admin Reports</h2>

    <!-- =======================
         SALES SUMMARY
    ======================== -->
    <div class="row g-4 mb-4">
        <div class="col-md-3">
            <div class="card shadow-sm text-center p-3">
                <h5>Total Orders</h5>
                <h3 class="text-primary fw-bold">@totalOrders</h3>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shadow-sm text-center p-3">
                <h5>Completed</h5>
                <h3 class="text-success fw-bold">@completedOrders</h3>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shadow-sm text-center p-3">
                <h5>Pending</h5>
                <h3 class="text-warning fw-bold">@pendingOrders</h3>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card shadow-sm text-center p-3">
                <h5>Total Revenue</h5>
                <h3 class="text-dark fw-bold">Rs. @totalRevenue</h3>
            </div>
        </div>
    </div>

    <!-- =======================
         FAKE CHART
    ======================== -->
    <h4 class="mt-3 mb-2">üìà Monthly Revenue (Fake Chart)</h4>
    <div class="p-3 bg-light rounded shadow-sm mb-4">
        <div class="progress mb-2">
            <div class="progress-bar" style="width: 30%">Jan</div>
        </div>
        <div class="progress mb-2">
            <div class="progress-bar bg-success" style="width: 50%">Feb</div>
        </div>
        <div class="progress mb-2">
            <div class="progress-bar bg-warning" style="width: 70%">Mar</div>
        </div>
        <div class="progress">
            <div class="progress-bar bg-danger" style="width: 90%">Apr</div>
        </div>
    </div>

    <!-- =======================
         BOOKS SUMMARY
    ======================== -->
    <h4 class="mt-4">üìö Books Summary</h4>
    <div class="row g-4 mb-4">
        <div class="col-md-4">
            <div class="card p-3 shadow-sm text-center">
                <h6>Total Books</h6>
                <h3 class="fw-bold">@totalBooks</h3>
            </div>
        </div>
@* 
        <div class="col-md-4">
            <div class="card p-3 shadow-sm text-center">
                <h6>Best Seller</h6>
                <h5>@bestSeller</h5>
            </div>
        </div> *@

        <div class="col-md-4">
            <div class="card p-3 shadow-sm text-center">
                <h6>Top Buyer</h6>
                <h5>@topBuyer</h5>
            </div>
        </div>
    </div>

    <h4 class="mt-4"> User Overview</h4>
    <div class="row g-4 mb-4">
        <div class="col-md-3">
            <div class="card p-3 shadow-sm text-center">
                <h6>Total Users</h6>
                <h3 class="fw-bold">@totalUsers</h3>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card p-3 shadow-sm text-center">
                <h6>Buyers</h6>
                <h3 class="text-primary fw-bold">@buyerCount</h3>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card p-3 shadow-sm text-center">
                <h6>Sellers</h6>
                <h3 class="text-success fw-bold">@sellerCount</h3>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card p-3 shadow-sm text-center">
                <h6>Admins</h6>
                <h3 class="text-danger fw-bold">@adminCount</h3>
            </div>
        </div>
    </div>

    <!-- =======================
         RECENT ORDERS TABLE
    ======================== -->
    <h4 class="mt-4 mb-3">üìù Recent Orders</h4>
    <table class="table table-bordered table-striped shadow-sm">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Buyer</th>
                <th>Book</th>
                <th>Qty</th>
                <th>Total (Rs.)</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var o in orders.TakeLast(5))
            {
                <tr>
                    <td>@o.OrderId</td>
                    <td>@o.BuyerId</td>
                    <td>@o.BookId</td>
                    <td>@o.Quantity</td>
                    <td>@o.TotalPrice</td>
                    <td>
                        <span class="badge @(o.Status == "Completed" ? "bg-success" : "bg-warning")">
                            @o.Status
                        </span>
                    </td>
                </tr>
            }
        </tbody>
    </table>

    <!-- Fake download button -->
    <button class="btn btn-primary mt-3">Download Report (PDF)</button>

</div>
}